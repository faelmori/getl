{
  "sourceType": "sqlserver",
  "sourceConnectionString": "sqlserver://sankhya:azsxdc@localhost:1433?database=sankhya_prod&encrypt=disable&trustservercertificate=true",
  "destinationType": "postgres",
  "destinationConnectionString": "postgres://kubex_adm:WtWOZyYFYx@localhost:5432/kubex_db?sslmode=disable",
  "destinationTable": "erp_prod_price_table",
  "sqlQuery": "WITH TIPO_FAST AS (\n    SELECT\n        O.VALOR\n         , O.OPCAO\n    FROM\n        TDDCAM C\n            INNER JOIN\n        TDDOPC O\n        ON C.NUCAMPO = O.NUCAMPO\n    WHERE\n        C.NOMETAB = 'TGFTAB'\n      AND C.NOMECAMPO= 'AD_TIPO_FAST'\n      AND O.VALOR LIKE 'D'\n)\n   , PRICETABS AS (\n    SELECT\n        T.CODTAB\n         , T.DTVIGOR\n         , T.CODREG\n         , T.DTALTER\n         , T.PERCENTUAL\n         , T.FORMULA\n         , T.CODTABORIG\n         , T.NUTAB\n         , T.JAPE_ID\n         , T.AD_MOBILIDADE\n         , T.UTILIZADECCUSTO\n         , T.AD_TIPO_FAST AS COD_TIPO_FAST\n         , F.OPCAO AS DESCR_TIPO_FAST\n    FROM\n        TGFTAB T\n            INNER JOIN\n        TIPO_FAST F\n        ON T.AD_TIPO_FAST = F.VALOR\n)\n   , PRICEREF AS (\n    SELECT\n        TOB.NUTAB\n         , TOB.DESCR_TIPO_FAST\n         , N'TABELA PADR\u00C3O SITE (NUTAB ' + CAST(TOB.NUTAB AS NVARCHAR) + ' - ' + 'TIPO PRE\u00C7O ' + TOB.DESCR_TIPO_FAST + ')' AS DESCRTAB\n    FROM\n        PRICETABS TOB\n    WHERE\n        TOB.DTVIGOR = (\n            SELECT\n                MAX(T.DTVIGOR)\n            FROM\n                TGFTAB T\n            WHERE\n                T.CODTAB = TOB.CODTAB\n        )\n)\n   , TABCHECK AS (\n    SELECT\n        E.CODPROD\n         , E.NUTAB\n         , P.DESCRTAB\n         , P.DESCR_TIPO_FAST\n    FROM\n        TGFEXC E\n            INNER JOIN\n        PRICEREF P\n        ON E.NUTAB = P.NUTAB\n)\n   , PARCIAL_A AS (\n    SELECT\n        LTRIM(RTRIM(CAST(P.CODPROD AS VARCHAR))) AS ProductId\n         , P.DESCRPROD as ProductName\n         , N.DESCRTAB AS PriceTableName\n         , [sankhya].SNK_GET_PRECO(N.NUTAB, P.CODPROD, CURRENT_TIMESTAMP) AS VLRUNIT\n         , N.DESCR_TIPO_FAST\n         , P.CODPROD\n    FROM\n        TGFPRO P\n            INNER JOIN\n        TABCHECK N\n        ON P.CODPROD = N.CODPROD\n            INNER JOIN\n        TGFMAR M\n        ON P.CODMARCA = M.CODIGO\n            AND M.AD_FASTREF = 'C'\n            AND M.AD_FAST = 'S'\n    WHERE\n        P.ATIVO = 'S'\n)\n   , PARCIAL_T AS (\n    SELECT\n        LTRIM(RTRIM(P.REFFORN)) AS ProductId\n         , P.DESCRPROD as ProductName\n         , N.DESCRTAB AS PriceTableName\n         , [sankhya].SNK_GET_PRECO(N.NUTAB, P.CODPROD, CURRENT_TIMESTAMP) AS VLRUNIT\n         , N.DESCR_TIPO_FAST\n         , P.CODPROD\n    FROM\n        TGFPRO P\n            INNER JOIN\n        TABCHECK N\n        ON P.CODPROD = N.CODPROD\n            INNER JOIN\n        TGFMAR M\n        ON P.CODMARCA = M.CODIGO\n            AND M.AD_FASTREF = 'R'\n            AND M.AD_FAST = 'S'\n    WHERE\n        P.ATIVO = 'S'\n)\n   , RES AS (\n    SELECT\n        PA.ProductId\n         , PA.ProductName\n         , PA.PriceTableName\n         , REPLACE(REPLACE(CONVERT(VARCHAR, FORMAT(ROUND(PA.VLRUNIT, 2), 'N2'), 2), '.', ''), ',', '') AS ListPrice\n         , REPLACE(REPLACE(CONVERT(VARCHAR, FORMAT(ROUND(PA.VLRUNIT, 2), 'N2'), 2), '.', ''), ',', '') AS SalePrice\n         , PA.DESCR_TIPO_FAST\n         , PA.CODPROD\n         , PA.VLRUNIT\n    FROM\n        PARCIAL_A PA\n    UNION ALL\n    SELECT\n        PT.ProductId\n         , PT.ProductName\n         , PT.PriceTableName\n         , REPLACE(REPLACE(CONVERT(VARCHAR, FORMAT(ROUND(PT.VLRUNIT, 2), 'N2'), 2), '.', ''), ',', '') AS ListPrice\n         , REPLACE(REPLACE(CONVERT(VARCHAR, FORMAT(ROUND(PT.VLRUNIT, 2), 'N2'), 2), '.', ''), ',', '') AS SalePrice\n         , PT.DESCR_TIPO_FAST\n         , PT.CODPROD\n         , PT.VLRUNIT\n    FROM\n        PARCIAL_T PT\n)\n\nSELECT\n    R.ProductId\n     , R.ProductName\n     , R.PriceTableName\n     , R.ListPrice\n     , R.SalePrice\n     , R.DESCR_TIPO_FAST\n     , R.CODPROD\n     , R.VLRUNIT\nFROM\n    RES R\n",
  "kafkaURL": "",
  "kafkaTopic": "",
  "kafkaGroupID": "",
  "primaryKey": "ProductId",
  "updateKey": "ProductId"
}
